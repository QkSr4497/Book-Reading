<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <link rel="Stylesheet" href="/css/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!--====== Javascripts & Jquery ======-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

</head>

<body>
  <div class="navigation-style">
    <div id="mySidenav" class="sidenav">
      <a href="javascript:void(0)" class="closebtn" onclick="closeSideNav()">&times;</a>
      <a href="home" key="home"> Home ğŸ </a>
      <a href="profile" key="myProfile">My Profile ğŸ‘¦</a>
      <a href="books" key="myBooks"> My Books ğŸ“š</a>
      <a href="quizes" key="myQuizes">My Quizes â±ï¸</a>
      <a href="notes" key="myNotes">My Notes  ğŸ“„</a>
      <a href="games" key="myGames">My Games ğŸ®</a>
      <a href="groups" key="myGroups"> My Groups ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</a>
      <a href="friends" key="myFriends"> My Friends ğŸ‘¨â€ğŸ‘©â€</a>
      <a href="account" key="myAccount">My Account  ğŸ’³</a>
      <a href="cart" key="myCart"> My Cart ğŸ›’</a>
      <a href="settings" key="settings">Settings ğŸ”§</a>
      <a href="../logout" key="logOut">Log Out ğŸƒ</a>
    </div>

      <div id="main">


       <div class="topnav" id="myTopnav">
          {{#if userData.points}}
              <a class="tablinks" id="pointsTitle">My points: {{userData.points}}</a>
          {{/if}}
          <a href="#" id="openNav" class="active "  key="open" onclick="openSideNav()">&#9776; open</a>
          <a class="tablinks" id="welcomeTitle">Welcome {{userData.userName}}</a>
          <a href="#news" key="2read">2READ</a>
          <a href="../books" key="books">Books</a>
          <a href="../games" key="store">Store</a>
          <a href="#" class="translate" id="arb">Arabic</a>
          <a href="#" class="translate" id="heb">Hebrew</a> 
          <a href="javascript:void(0);" class="icon" onclick="responsiveNav()">
            <i class="fa fa-bars"></i>
          </a>
       </div>


          <div class="my-books-style">
           <h2>&#128218; My Books Board</h2>
            <div class="row">

                <div id="intrested" class="intrested column" ondrop="drop(event)" ondragover="allowDropIntrested(event)">
                    <div class="div_title">
                      <h4>Books I want to read</h4>
                    </div>
                      {{#each bookDataByTypes.intrestedBooks}}
                      <form method="POST" action="/kid/books/edit">
                      <a class="a" name={{bookName}}  draggable="true" ondragstart="drag(event)" id={{bookID}}>
                        {{bookName}} 
                      </a> 
                    </form>
                       {{/each }}
                </div>
           





                
                <div id="reading" class="reading column" ondrop="drop(event)" ondragover="allowDropReading(event)">
                    <form id="readingForm" method="POST" action="/kid/books/edit"></form>
                    <div class="div_title">
                      <h4>Books I am reading</h4>
                    </div>
                      {{#each bookDataByTypes.readingBooks}}
                      
                      <a class="a" draggable="true" ondragstart="drag(event)" id="{{bookID}}">
                        {{bookName}}
                      </a> 
              
                       {{/each }}
                    </form>
                </div>







                <div id="finished" class="finished column"  ondrop="drop(event)" ondragover="allowDropFinish(event)">
                  <div class="div_title">
                    <h4>Books I have read</h4>
                  </div>
                    {{#each bookDataByTypes.finishedBooks}}
   
                      <a class="a" draggable="false" id="{{bookID}}">
                        {{bookName}} 
                      </a>  
                    {{/each }}
                </div>
              </div>
          </div>

{{!-- main --}}
  </div>
</div>






<script>
  function allowDropIntrested(ev) {
    if(ev.target.id==="intrested"){
    ev.preventDefault();
    }

  }

  function allowDropReading(ev) {
    console.log('allowDropReading '+ ev.target.id )
     if(ev.target.id === "reading"){
      console.log('prevented moving : '+ev.dataTransfer.getData("text") + 'to: ' + ev.target.id );
    ev.preventDefault();
    ev.stopPropagation();

    }
  }
    function allowDropFinish(ev) {
       if(ev.target.id === 'finished'){
    ev.preventDefault();
    }
  }

  function drag(ev) {
    ev.dataTransfer.setData("text", ev.target.id);
     console.log('drag: '+ev.dataTransfer.getData("text"));
  }


    const updateBookType = ( (bookID, bookType, callback) => {
      var bookData = {};
      bookData.bookID = bookID;
      bookData.bookType = bookType;
      console.log('new object ' +JSON.stringify(bookData));
      var url = '/kid/books/edit';
      $.ajax({
        url: url,
        type: 'POST',
        data: bookData,
        success: function (result) {
            callback(undefined , result.status);
       },
      error: function (err) {
            callback('error updating book type', undefined);
       }
    });
      });
  

  function drop(ev) {
    ev.preventDefault();
    var data = ev.dataTransfer.getData("text");
    ev.target.appendChild(document.getElementById(data));
    console.log('movigng book : '+ev.dataTransfer.getData("text"));
    console.log('to '+ev.target.id);

    var bookID=ev.dataTransfer.getData("text");
    var bookType=ev.target.id;
    updateBookType(bookID, bookType, (error, result) => {
      if (error) {
        console.log(error);
      }
      else {
          console.log('status: ' + result);
      }
      
    });
  }
</script>



<script type="text/javascript" src="js/navigation.js"></script>
<script type="text/javascript" src="js/language.js"></script>
<script type="text/javascript" src="js/myBooks-scripts.js"></script>

</body>

</html>